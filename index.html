<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>IT Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* ==== Theme Variables ==== */
        :root {
            --primary-color: #2e59a7;
            --secondary-color: #3b82f6;
            --background-light: #f3f4f6;
            --surface-color: #ffffff;
            --text-dark: #1f2937;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                         0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 
                         0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:"Sarabun",sans-serif; background:var(--background-light); color:var(--text-dark);}
        header { background:var(--primary-color); color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center;}
        header h1{ font-size:24px; font-weight:700;}
        nav a{ margin-left:1.5rem; color:rgba(255,255,255,0.8); text-decoration:none; font-weight:500; transition:0.3s;}
        nav a:hover{ color:#fff;}
        .container{ max-width:1200px; margin:2rem auto; padding:0 1.5rem;}
        .section-header{ font-size:2rem; font-weight:700; margin:2rem 0 1.5rem; color:var(--text-dark); display:flex; align-items:center; gap:1rem;}
        /* === Dashboard & Cards === */
        .dashboard-content{ display:flex; flex-wrap:wrap; gap:2rem; justify-content:center; align-items:flex-start;}
        .dashboard-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; width:100%;}
        .card{ background:var(--surface-color); border-radius:12px; padding:1.5rem; text-align:center; box-shadow:var(--shadow-md); transition:0.3s;}
        .card:hover{ transform:translateY(-5px); box-shadow:var(--shadow-lg);}
        .card h3{ font-size:1rem; margin-bottom:0.5rem; color:var(--text-muted);}
        .card p{ font-size:2.5rem; font-weight:bold; color:var(--primary-color);}
        .summary-card{ display:flex; align-items:center; gap:1rem; text-align:left;}
        .summary-card i{ font-size:2.5rem; color:var(--secondary-color);}
        /* === Table === */
        table{ width:100%; border-collapse:collapse; background:var(--surface-color); border-radius:12px; overflow:hidden; box-shadow:var(--shadow-md); margin-top:1.5rem;}
        th,td{ padding:1rem; border-bottom:1px solid var(--border-color);}
        th{ background:#e2e8f0; text-align:center; font-weight:600;}
        tr:hover{ background:#f8fafc;}
        .status-badge{ display:inline-block; padding:0.4rem 0.8rem; border-radius:999px; font-size:0.875rem; font-weight:600; color:#fff;}
        .status-pending{ background:#facc15;} .status-assigned{ background:#3b82f6;} .status-completed{ background:#10b981;}
        .btn-action{ padding:0.5rem 1rem; border:none; border-radius:8px; cursor:pointer; margin:0 0.25rem; font-size:0.875rem; font-weight:500;}
        .btn-assign{ background:#3b82f6; color:#fff;} .btn-complete{ background:#10b981; color:#fff;} .btn-delete{ background:#ef4444; color:#fff;}
        .btn-assign:hover{ background:#2563eb;} .btn-complete:hover{ background:#059669;} .btn-delete:hover{ background:#dc2626;}
        /* === Pie Chart === */
        .pie-chart-container{ background:var(--surface-color); border-radius:12px; padding:2rem; box-shadow:var(--shadow-md); width:100%; max-width:400px;}
        .pie-chart{ width:150px; height:150px; border-radius:50%; margin:1.5rem auto; position:relative;}
        .pie-chart::before{ content:''; position:absolute; top:50%; left:50%; width:70px; height:70px; background:var(--background-light); border-radius:50%; transform:translate(-50%,-50%);}
        .legend{ list-style:none; margin-top:2rem;}
        .legend-item{ display:flex; justify-content:space-between; margin-bottom:0.75rem;}
        .legend-color{ width:1rem; height:1rem; border-radius:4px; margin-right:0.75rem;}
    </style>
</head>
<body>
<header>
    <h1>IT Dashboard</h1>
    <nav>
        <a href="#" onclick="showPage('dashboard')">Dashboard</a>
        <a href="#" onclick="showPage('list')">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a>
    </nav>
</header>

<div class="container">
    <!-- Dashboard -->
    <section id="dashboardPage">
        <h2 class="section-header">üìà Dashboard</h2>
        <div class="dashboard-content">
            <div class="pie-chart-container">
                <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h3>
                <div class="pie-chart" id="statusPieChart"></div>
                <ul class="legend">
                    <li class="legend-item"><span class="legend-color" style="background:#facc15;"></span> ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ <span id="legendPending"></span></li>
                    <li class="legend-item"><span class="legend-color" style="background:#3b82f6;"></span> ‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡πÅ‡∏•‡πâ‡∏ß <span id="legendAssigned"></span></li>
                    <li class="legend-item"><span class="legend-color" style="background:#10b981;"></span> ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß <span id="legendDone"></span></li>
                </ul>
            </div>
            <div class="dashboard-grid">
                <div class="card summary-card"><i class="fas fa-list-check"></i><div><h3>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p id="totalCount">0</p></div></div>
                <div class="card summary-card"><i class="fas fa-clock"></i><div><h3>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3><p id="pendingCount">0</p></div></div>
                <div class="card summary-card"><i class="fas fa-hammer"></i><div><h3>‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡πÅ‡∏•‡πâ‡∏ß</h3><p id="assignedCount">0</p></div></div>
                <div class="card summary-card"><i class="fas fa-circle-check"></i><div><h3>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</h3><p id="doneCount">0</p></div></div>
            </div>
        </div>
    </section>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° -->
    <section id="listPage" style="display:none;">
        <h2 class="section-header"><i class="fas fa-clipboard-list"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <table>
            <thead>
                <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
                    <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                    <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th>
                    <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="repairList"></tbody>
        </table>
    </section>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbynxcmWH6p10gxVcphnuqptOSAs36aC4L7ipUHhUszaVArFwkyY-eHsrMFWW5BNXgoY/exec";

function showPage(pageId){
    document.getElementById("dashboardPage").style.display = pageId==="dashboard"?"block":"none";
    document.getElementById("listPage").style.display = pageId==="list"?"block":"none";
    if(pageId==="dashboard"||pageId==="list"){ loadData(); }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
async function loadData(){
    try{
        const res = await fetch(API_URL);
        const data = await res.json();
        const tbody = document.getElementById("repairList");
        tbody.innerHTML="";
        let total=0,pending=0,assigned=0,done=0;
        data.forEach(row=>{
            total++;
            if(row.status==="Pending") pending++;
            else if(row.status==="Assigned") assigned++;
            else if(row.status==="Completed") done++;

            let statusClass="",statusText="";
            if(row.status==="Pending"){statusClass="status-pending";statusText="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£";}
            else if(row.status==="Assigned"){statusClass="status-assigned";statusText="‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡πÅ‡∏•‡πâ‡∏ß";}
            else if(row.status==="Completed"){statusClass="status-completed";statusText="‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß";}

            const tr=document.createElement("tr");
            tr.innerHTML=`
                <td>${row.name}</td>
                <td>${row.department}</td>
                <td>${row.issue}</td>
                <td>${row.imageUrl?`<img src="${row.imageUrl}" style="width:50px;height:50px;object-fit:cover;border-radius:4px;">`:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ'}</td>
                <td>${row.date}</td>
                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                <td>
                    <button class="btn-action btn-assign" onclick="updateStatus('${row.employeeID}','Assigned')">‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™</button>
                    <button class="btn-action btn-complete" onclick="updateStatus('${row.employeeID}','Completed')">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
                    <button class="btn-action btn-delete" onclick="deleteRow('${row.employeeID}')">‡∏•‡∏ö</button>
                </td>`;
            tbody.appendChild(tr);
        });

        // update dashboard
        document.getElementById("totalCount").innerText=total;
        document.getElementById("pendingCount").innerText=pending;
        document.getElementById("assignedCount").innerText=assigned;
        document.getElementById("doneCount").innerText=done;

        const pie=document.getElementById("statusPieChart");
        if(total>0){
            let p=(pending/total)*100,a=(assigned/total)*100,d=(done/total)*100;
            pie.style.background=`conic-gradient(#facc15 0% ${p}%, #3b82f6 ${p}% ${p+a}%, #10b981 ${p+a}% 100%)`;
        }else{
            pie.style.background=`conic-gradient(#eee 100%)`;
        }
        document.getElementById("legendPending").innerText=`${pending} (${total>0?(pending/total*100).toFixed(0):0}%)`;
        document.getElementById("legendAssigned").innerText=`${assigned} (${total>0?(assigned/total*100).toFixed(0):0}%)`;
        document.getElementById("legendDone").innerText=`${done} (${total>0?(done/total*100).toFixed(0):0}%)`;
    }catch(err){ console.error(err); }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
async function updateStatus(employeeID,newStatus){
    try{
        const res=await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({action:"update",employeeID:employeeID,status:newStatus})
        });
        const result=await res.json();
        if(result.status==="success"){ loadData();}
        else{ alert("‚ùå "+(result.message||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏î‡πâ")); }
    }catch(e){ alert("‚ùå Error: "+e.message); }
}

// ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß
async function deleteRow(employeeID){
    if(!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;
    try{
        const res=await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({action:"delete",employeeID:employeeID})
        });
        const result=await res.json();
        if(result.status==="success"){ loadData();}
        else{ alert("‚ùå "+(result.message||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ")); }
    }catch(e){ alert("‚ùå Error: "+e.message); }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
loadData();
// ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ refresh ‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
setInterval(loadData, 3000);
</script>


</body>
</html>
